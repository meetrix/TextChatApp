<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://simplewebrtc.com/latest-v2.js"></script>
    <script type="text/javascript">
        function setText(UserMsg) {
            console.log(UserMsg);
        }
    </script>
    <meta charset="UTF-8">
    <title>TextChat</title>
</head>
<body>
        <h3>Portal Chat Room</h3>
        <br><br>
        <video height="300" id="localVideo"></video>
        <div id="remoteVideos"></div>
        <br><br><br>
        <input name="message" id="text" type="text" />
        <input name="button" onclick="setText(getElementById('text').value)" type="button" value="Send" id="send"/>
        <br><br><br>
        <input name="reply" id="messages" type="text" value=""/>

</body>
<script>
    //var webrtc = new SimpleWebRTC();
    var room = 'PortalChatRoom';
    var webrtc = new SimpleWebRTC({
        // the id/element dom element that will hold "our" video
        localVideoEl: 'localVideo',
        // the id/element dom element that will hold remote videos
        remoteVideosEl: 'remoteVideos',
        // immediately ask for camera access
        autoRequestMedia: true
    });
    webrtc.joinRoom(room);

    //For Text Chat ------------------------------------------------------------------
    // Await messages from others

    webrtc.connection.on('message', function(data){
        console.log("Received");
        if(data.type === 'chat'){
            console.log('chat received',data.payload.message);
            $('#messages').append('<br>' + data.payload.nick + ':<br>' + data.payload.message);
        }
    });

    // Send a chat message
    $('#send').click(function(){
        var msg = $('#text').val();
        webrtc.sendToAll('chat', {message: msg, nick: webrtc.config.nick});
        $('#messages').append('<br>You:<br>' + msg);
        $('#text').val('');
    });
</script>
</html>